<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Checking model assumption - linear models • performance</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Checking model assumption - linear models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">performance</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.13.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html" aria-label="Reference"><span class="fa fa-file-code"></span> Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html" aria-label="Articles"><span class="fa fa-book-reader"></span> Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html" aria-label="News"><span class="fa fa-newspaper"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-easystats" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="easystats"><span class="fa fab fa-r-project"></span> easystats</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-easystats">
<li><a class="external-link dropdown-item" href="https://easystats.github.io/bayestestR/">bayestestR</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/correlation/">correlation</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/datawizard/">datawizard</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/easystats/">easystats</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/effectsize/">effectsize</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/insight/">insight</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/modelbased/">modelbased</a></li>
    <li><a class="dropdown-item" href="https://easystats.github.io/performance/">performance</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/parameters/">parameters</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/report/">report</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/see/">see</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="http://twitter.com/easystats4u" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/easystats/performance/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Checking model assumption - linear models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/easystats/performance/blob/main/vignettes/check_model.Rmd" class="external-link"><code>vignettes/check_model.Rmd</code></a></small>
      <div class="d-none name"><code>check_model.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="make-sure-your-model-inference-is-accurate">Make sure your model inference is accurate!<a class="anchor" aria-label="anchor" href="#make-sure-your-model-inference-is-accurate"></a>
</h2>
<p>Model diagnostics is crucial, because parameter estimation, p-values
and confidence interval depend on correct model assumptions as well as
on the data. If model assumptions are violated, estimates can be
statistically significant “even if the effect under study is null”
(<em>Gelman/Greenland 2019</em>).</p>
<p>There are several problems associated with model diagnostics.
Different types of models require different checks. For instance,
normally distributed residuals are assumed to apply for linear
regression, but is no appropriate assumption for logistic regression.
Furthermore, it is recommended to carry out visual inspections, i.e. to
generate and inspect so called diagnostic plots of model assumptions -
formal statistical tests are often too strict and warn of violation of
the model assumptions, although everything is fine within a certain
tolerance range. But how should such diagnostic plots be interpreted?
And if violations have been detected, how to fix them?</p>
<p>This vignette introduces the <code><a href="../reference/check_model.html">check_model()</a></code> function of
the <strong>performance</strong> package, shows how to use this function
for different types of models and how the resulting diagnostic plots
should be interpreted. Furthermore, recommendations are given how to
address possible violations of model assumptions.</p>
<p>Most plots seen here can also be generated by their dedicated
functions, e.g.:</p>
<ul>
<li>Posterior predictive checks: <code><a href="../reference/check_predictions.html">check_predictions()</a></code>
</li>
<li>Homogeneity of variance:
<code><a href="../reference/check_heteroscedasticity.html">check_heteroskedasticity()</a></code>
</li>
<li>Normality of residuals: <code><a href="../reference/check_normality.html">check_normality()</a></code>
</li>
<li>Multicollinearity: <code><a href="../reference/check_collinearity.html">check_collinearity()</a></code>
</li>
<li>Influential observations: <code><a href="../reference/check_outliers.html">check_outliers()</a></code>
</li>
<li>Binned residuals: <code><a href="../reference/binned_residuals.html">binned_residuals()</a></code>
</li>
<li>Check for overdispersion: <code><a href="../reference/check_overdispersion.html">check_overdispersion()</a></code>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="linear-models-are-all-assumptions-for-linear-models-met">Linear models: Are all assumptions for linear models met?<a class="anchor" aria-label="anchor" href="#linear-models-are-all-assumptions-for-linear-models-met"></a>
</h2>
<p>We start with a simple example for a linear model.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Sepal.Width</span> <span class="op">~</span> <span class="va">Species</span> <span class="op">+</span> <span class="va">Petal.Length</span> <span class="op">+</span> <span class="va">Petal.Width</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span></code></pre></div>
<p>Before we go into details of the diagnostic plots, let’s first look
at the summary table.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/parameters/" class="external-link">parameters</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html" class="external-link">model_parameters</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Parameter            | Coefficient |   SE |         95% CI | t(145) |      p</span></span>
<span><span class="co">#&gt; ----------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; (Intercept)          |        3.05 | 0.09 | [ 2.86,  3.23] |  32.52 | &lt; .001</span></span>
<span><span class="co">#&gt; Species [versicolor] |       -1.76 | 0.18 | [-2.12, -1.41] |  -9.83 | &lt; .001</span></span>
<span><span class="co">#&gt; Species [virginica]  |       -2.20 | 0.27 | [-2.72, -1.67] |  -8.28 | &lt; .001</span></span>
<span><span class="co">#&gt; Petal Length         |        0.15 | 0.06 | [ 0.03,  0.28] |   2.38 | 0.018 </span></span>
<span><span class="co">#&gt; Petal Width          |        0.62 | 0.14 | [ 0.35,  0.89] |   4.57 | &lt; .001</span></span></code></pre></div>
<p>There is nothing suspicious so far. Now let’s start with model
diagnostics. We use the <code><a href="../reference/check_model.html">check_model()</a></code> function, which
provides an overview with the most important and appropriate diagnostic
plots for the model under investigation.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/performance/">performance</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span></code></pre></div>
<p><img src="check_model_files/figure-html/unnamed-chunk-4-1.png" width="100%" height="100%"></p>
<p>Now let’s take a closer look for each plot. To do so, we ask
<code><a href="../reference/check_model.html">check_model()</a></code> to return a single plot for each check,
instead of arranging them in a grid. We can do so using the
<code>panel</code> argument. This returns a list of <em>ggplot</em>
plots.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># return a list of single plots</span></span>
<span><span class="va">diagnostic_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">m1</span>, panel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="posterior-predictive-checks">Posterior predictive checks<a class="anchor" aria-label="anchor" href="#posterior-predictive-checks"></a>
</h3>
<p>The first plot is based on <code><a href="../reference/check_predictions.html">check_predictions()</a></code>.
Posterior predictive checks can be used to “look for systematic
discrepancies between real and simulated data” (<em>Gelman et al. 2014,
p. 169</em>). It helps to see whether the type of model (distributional
family) fits well to the data (<em>Gelman and Hill, 2007,
p. 158</em>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># posterior predicive checks</span></span>
<span><span class="va">diagnostic_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="check_model_files/figure-html/unnamed-chunk-6-1.png" width="80%" height="80%"></p>
<p>The blue lines are simulated data based on the model, if the model
were true and distributional assumptions met. The green line represents
the actual observed data of the response variable.</p>
<p>This plot looks good, and thus we would not assume any violations of
model assumptions here.</p>
<p>Next, a different example. We use a Poisson-distributed outcome for
our linear model, so we should expect some deviation from the
distributional assumption of a linear model.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">99</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">iris</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">skewed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">skewed</span> <span class="op">~</span> <span class="va">Species</span> <span class="op">+</span> <span class="va">Petal.Length</span> <span class="op">+</span> <span class="va">Petal.Width</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_predictions.html">check_predictions</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
<p><img src="check_model_files/figure-html/unnamed-chunk-7-1.png" width="80%" height="80%"></p>
<p>As you can see, the green line in this plot deviates visibly from the
blue lines. This may indicate that our linear model is not appropriate,
since it does not capture the distributional nature of the response
variable properly.</p>
<div class="section level4">
<h4 id="how-to-fix-this">How to fix this?<a class="anchor" aria-label="anchor" href="#how-to-fix-this"></a>
</h4>
<p>The best way, if there are serious concerns that the model does not
fit well to the data, is to use a different type (family) of regression
models. In our example, it is obvious that we should better use a
Poisson regression.</p>
</div>
<div class="section level4">
<h4 id="plots-for-discrete-outcomes">Plots for discrete outcomes<a class="anchor" aria-label="anchor" href="#plots-for-discrete-outcomes"></a>
</h4>
<p>For discrete or integer outcomes (like in logistic or Poisson
regression), density plots are not always the best choice, as they look
somewhat “wiggly” around the actual values of the dependent variables.
In this case, use the <code>type</code> argument of the
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method to change the plot-style. Available options
are <code>type = "discrete_dots"</code> (dots for observed and
replicated outcomes), <code>type = "discrete_interval"</code> (dots for
observed, error bars for replicated outcomes) or
<code>type = "discrete_both"</code> (both dots and error bars).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">99</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">iris</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">skewed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">skewed</span> <span class="op">~</span> <span class="va">Species</span> <span class="op">+</span> <span class="va">Petal.Length</span> <span class="op">+</span> <span class="va">Petal.Width</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">d</span></span>
<span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_predictions.html">check_predictions</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span>, type <span class="op">=</span> <span class="st">"discrete_both"</span><span class="op">)</span></span></code></pre></div>
<p><img src="check_model_files/figure-html/unnamed-chunk-8-1.png" width="80%" height="80%"></p>
</div>
</div>
<div class="section level3">
<h3 id="linearity">Linearity<a class="anchor" aria-label="anchor" href="#linearity"></a>
</h3>
<p>This plot helps to check the assumption of linear relationship. It
shows whether predictors may have a non-linear relationship with the
outcome, in which case the reference line may roughly indicate that
relationship. A straight and horizontal line indicates that the model
specification seems to be ok.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># linearity</span></span>
<span><span class="va">diagnostic_plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="check_model_files/figure-html/unnamed-chunk-9-1.png" width="80%" height="80%"></p>
<p>Now to a different example, where we simulate data with a quadratic
relationship of one of the predictors and the outcome.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span></span>
<span><span class="co"># quadratic relationship</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">m</span>, panel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># linearity plot</span></span>
<span><span class="va">out</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="check_model_files/figure-html/unnamed-chunk-10-1.png" width="80%" height="80%"></p>
<div class="section level4">
<h4 id="how-to-fix-this-1">How to fix this?<a class="anchor" aria-label="anchor" href="#how-to-fix-this-1"></a>
</h4>
<p>If the green reference line is not roughly flat and horizontal, but
rather - like in our example - U-shaped, this may indicate that some of
the predictors probably should better be modeled as quadratic term.
Transforming the response variable might be another solution when
linearity assumptions are not met.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># model quadratic term</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">m</span>, panel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># linearity plot</span></span>
<span><span class="va">out</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="check_model_files/figure-html/unnamed-chunk-11-1.png" width="80%" height="80%"></p>
<p><strong>Some caution is needed</strong> when interpreting these
plots. Although these plots are helpful to check model assumptions, they
do not necessarily indicate so-called “lack of fit”, e.g. missed
non-linear relationships or interactions. Thus, it is always recommended
to also look at <a href="https://strengejacke.github.io/ggeffects/articles/introduction_partial_residuals.html" class="external-link">effect
plots, including partial residuals</a>.</p>
</div>
</div>
<div class="section level3">
<h3 id="homogeneity-of-variance---detecting-heteroscedasticity">Homogeneity of variance - detecting heteroscedasticity<a class="anchor" aria-label="anchor" href="#homogeneity-of-variance---detecting-heteroscedasticity"></a>
</h3>
<p>This plot helps to check the assumption of equal (or constant)
variance, i.e. homoscedasticity. To meet this assumption, the variance
of the residuals across different values of predictors is similar and
does not notably increase or decrease. Hence, the desired pattern would
be that dots spread equally above and below a roughly straight,
horizontal line and show no apparent deviation.</p>
<p>Usually, this can be easily inspected when plotting the residuals
against fitted values, possibly adding trend lines to the plot. If these
are horizontal and parallel, everything is ok. If the spread of the dot
increases (decreases) across the x-axis, the model may suffer from
heteroscedasticity.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>,</span>
<span>  grp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, colour <span class="op">=</span> <span class="va">grp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="check_model_files/figure-html/unnamed-chunk-12-1.png" width="80%" height="80%"></p>
<p>For our example model, we see that our model indeed violates the
assumption of homoscedasticity.</p>
<p>But why does the diagnostic plot used in <code><a href="../reference/check_model.html">check_model()</a></code>
look different? <code><a href="../reference/check_model.html">check_model()</a></code> plots the square-root of the
absolute values of residuals. This makes the visual inspection slightly
easier, as you only have one line that needs to be judged. A roughly
flat and horizontal green reference line indicates homoscedasticity. A
steeper slope of that line indicates that the model suffers from
heteroscedasticity.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># homoscedasticiy - homogeneity of variance</span></span>
<span><span class="va">diagnostic_plots</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="check_model_files/figure-html/unnamed-chunk-13-1.png" width="80%" height="80%"></p>
<div class="section level4">
<h4 id="how-to-fix-this-2">How to fix this?<a class="anchor" aria-label="anchor" href="#how-to-fix-this-2"></a>
</h4>
<p>There are several ways to address heteroscedasticity.</p>
<ol style="list-style-type: decimal">
<li><p>Calculating heteroscedasticity-consistent standard errors
accounts for the larger variation, better reflecting the increased
uncertainty. This can be easily done using the
<strong>parameters</strong> package,
e.g. <code>parameters::model_parameters(m1, vcov = "HC3")</code>. A
detailed vignette on robust standard errors <a href="https://easystats.github.io/parameters/articles/model_parameters_robust.html" class="external-link">can
be found here</a>.</p></li>
<li><p>The heteroscedasticity can be modeled directly, e.g. using
package <strong>glmmTMB</strong> and the dispersion formula, to estimate
the dispersion parameter and account for heteroscedasticity (see
<em>Brooks et al. 2017</em>).</p></li>
<li><p>Transforming the response variable, for instance, taking the
<code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code>, may also help to avoid issues with
heteroscedasticity.</p></li>
<li><p>Weighting observations is another remedy against
heteroscedasticity, in particular the method of <a href="https://online.stat.psu.edu/stat501/lesson/13/13.1" class="external-link">weighted least
squares</a>.</p></li>
</ol>
</div>
</div>
<div class="section level3">
<h3 id="influential-observations---outliers">Influential observations - outliers<a class="anchor" aria-label="anchor" href="#influential-observations---outliers"></a>
</h3>
<p>Outliers can be defined as particularly influential observations, and
this plot helps detecting those outliers. Cook’s distance (<em>Cook
1977</em>, <em>Cook &amp; Weisberg 1982</em>) is used to define
outliers, i.e. any point in this plot that falls outside of Cook’s
distance (the dashed lines) is considered an influential
observation.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># influential observations - outliers</span></span>
<span><span class="va">diagnostic_plots</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="check_model_files/figure-html/unnamed-chunk-14-1.png" width="80%" height="80%"></p>
<p>In our example, everything looks well.</p>
<div class="section level4">
<h4 id="how-to-fix-this-3">How to fix this?<a class="anchor" aria-label="anchor" href="#how-to-fix-this-3"></a>
</h4>
<p>Dealing with outliers is not straightforward, as it is not
recommended to automatically discard any observation that has been
marked as “an outlier”. Rather, your <em>domain knowledge</em> must be
involved in the decision whether to keep or omit influential
observation. A helpful heuristic is to distinguish between error
outliers, interesting outliers, and random outliers (<em>Leys et
al. 2019</em>). <em>Error outliers</em> are likely due to human error
and should be corrected before data analysis. <em>Interesting
outliers</em> are not due to technical error and may be of theoretical
interest; it might thus be relevant to investigate them further even
though they should be removed from the current analysis of interest.
<em>Random outliers</em> are assumed to be due to chance alone and to
belong to the correct distribution and, therefore, should be
retained.</p>
</div>
</div>
<div class="section level3">
<h3 id="multicollinearity">Multicollinearity<a class="anchor" aria-label="anchor" href="#multicollinearity"></a>
</h3>
<p>This plot checks for potential collinearity among predictors. In a
nutshell multicollinearity means that once you know the effect of one
predictor, the value of knowing the other predictor is rather low.
Multicollinearity might arise when a third, unobserved variable has a
causal effect on each of the two predictors that are associated with the
outcome. In such cases, the actual relationship that matters would be
the association between the unobserved variable and the outcome.</p>
<p>Multicollinearity should not be confused with a raw strong
correlation between predictors. What matters is the association between
one or more predictor variables, <em>conditional on the other variables
in the model</em>.</p>
<p>If multicollinearity is a problem, the model seems to suggest that
the predictors in question don’t seems to be reliably associated with
the outcome (low estimates, high standard errors), although these
predictors actually are strongly associated with the outcome,
i.e. indeed might have strong effect (<em>McElreath 2020, chapter
6.1</em>).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># multicollinearity</span></span>
<span><span class="va">diagnostic_plots</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="check_model_files/figure-html/unnamed-chunk-15-1.png" width="80%" height="80%"></p>
<p>The variance inflation factor (VIF) indicates the magnitude of
multicollinearity of model terms. The thresholds for low, moderate and
high collinearity are VIF values less than 5, between 5 and 10 and
larger than 10, respectively (<em>James et al. 2013</em>). Note that
these thresholds, although commonly used, are also criticized for being
too high. <em>Zuur et al. (2010)</em> suggest using lower values, e.g. a
VIF of 3 or larger may already no longer be considered as “low”.</p>
<p>Our model clearly suffers from multicollinearity, as all predictors
have high VIF values.</p>
<div class="section level4">
<h4 id="how-to-fix-this-4">How to fix this?<a class="anchor" aria-label="anchor" href="#how-to-fix-this-4"></a>
</h4>
<p>Usually, predictors with (very) high VIF values should be removed
from the model to fix multicollinearity. Some caution is needed for
interaction terms. If interaction terms are included in a model, high
VIF values are expected. This portion of multicollinearity among the
component terms of an interaction is also called “inessential
ill-conditioning”, which leads to inflated VIF values that are typically
seen for models with interaction terms <em>(Francoeur 2013)</em>. In
such cases, try centering the involved interaction terms, which can
reduce multicollinearity <em>(Kim and Jung 2024)</em>, or re-fit your
model without interaction terms and check this model for collinearity
among predictors.</p>
</div>
</div>
<div class="section level3">
<h3 id="normality-of-residuals">Normality of residuals<a class="anchor" aria-label="anchor" href="#normality-of-residuals"></a>
</h3>
<p>In linear regression, residuals should be normally distributed. This
can be checked using so-called Q-Q plots (quantile-quantile plot) to
compare the shapes of distributions. This plot shows the quantiles of
the studentized residuals versus fitted values.</p>
<p>Usually, dots should fall along the green reference line. If there is
some deviation (mostly at the tails), this indicates that the model
doesn’t predict the outcome well for the range that shows larger
deviations from the reference line. In such cases, inferential
statistics like the p-value or coverage of confidence intervals can be
inaccurate.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># normally distributed residuals</span></span>
<span><span class="va">diagnostic_plots</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="check_model_files/figure-html/unnamed-chunk-16-1.png" width="80%" height="80%"></p>
<p>In our example, we see that most data points are ok, except some
observations at the tails. Whether any action is needed to fix this or
not can also depend on the results of the remaining diagnostic plots. If
all other plots indicate no violation of assumptions, some deviation of
normality, particularly at the tails, can be less critical.</p>
<div class="section level4">
<h4 id="how-to-fix-this-5">How to fix this?<a class="anchor" aria-label="anchor" href="#how-to-fix-this-5"></a>
</h4>
<p>Here are some remedies to fix non-normality of residuals, according
to <em>Pek et al. 2018</em>.</p>
<ol style="list-style-type: decimal">
<li><p>For large sample sizes, the assumption of normality can be
relaxed due to the central limit theorem - no action needed.</p></li>
<li><p>Calculating heteroscedasticity-consistent standard errors can
help. See section <strong>Homogeneity of variance</strong> for
details.</p></li>
<li><p>Bootstrapping is another alternative to resolve issues with
non-normally residuals. Again, this can be easily done using the
<strong>parameters</strong> package,
e.g. <code>parameters::model_parameters(m1, bootstrap = TRUE)</code> or
<a href="https://easystats.github.io/parameters/reference/bootstrap_parameters.html" class="external-link"><code>parameters::bootstrap_parameters()</code></a>.</p></li>
</ol>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Brooks ME, Kristensen K, Benthem KJ van, Magnusson A, Berg CW,
Nielsen A, et al. glmmTMB Balances Speed and Flexibility Among Packages
for Zero-inflated Generalized Linear Mixed Modeling. The R Journal.
2017;9: 378-400.</p>
<p>Cook RD. Detection of influential observation in linear regression.
Technometrics. 1977;19(1): 15-18.</p>
<p>Cook RD and Weisberg S. Residuals and Influence in Regression.
London: Chapman and Hall, 1982.</p>
<p>Francoeur RB. Could Sequential Residual Centering Resolve Low
Sensitivity in Moderated Regression? Simulations and Cancer Symptom
Clusters. Open Journal of Statistics. 2013:03(06), 24-44.</p>
<p>Gelman A, Carlin JB, Stern HS, Dunson DB, Vehtari A, and Rubin DB.
Bayesian data analysis. (Third edition). CRC Press, 2014</p>
<p>Gelman A, Greenland S. Are confidence intervals better termed
“uncertainty intervals”? BMJ. 2019;l5381. <a href="doi:10.1136/bmj.l5381" class="uri">doi:10.1136/bmj.l5381</a></p>
<p>Gelman A, and Hill J. Data analysis using regression and
multilevel/hierarchical models. Cambridge; New York. Cambridge
University Press, 2007</p>
<p>James, G., Witten, D., Hastie, T., and Tibshirani, R. (eds.).An
introduction to statistical learning: with applications in R. New York:
Springer, 2013</p>
<p>Kim, Y., &amp; Jung, G. (2024). Understanding linear interaction
analysis with causal graphs. British Journal of Mathematical and
Statistical Psychology, 00, 1–14.</p>
<p>Leys C, Delacre M, Mora YL, Lakens D, Ley C. How to Classify, Detect,
and Manage Univariate and Multivariate Outliers, With Emphasis on
Pre-Registration. International Review of Social Psychology, 2019</p>
<p>McElreath, R. Statistical rethinking: A Bayesian course with examples
in R and Stan. 2nd edition. Chapman and Hall/CRC, 2020</p>
<p>Pek J, Wong O, Wong ACM. How to Address Non-normality: A Taxonomy of
Approaches, Reviewed, and Illustrated. Front Psychol (2018) 9:2104. doi:
10.3389/fpsyg.2018.02104</p>
<p>Zuur AF, Ieno EN, Elphick CS. A protocol for data exploration to
avoid common statistical problems: Data exploration. Methods in Ecology
and Evolution (2010) 1:3-14.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/strengejacke" class="external-link">Daniel Lüdecke</a>, <a href="https://dominiquemakowski.github.io/" class="external-link">Dominique Makowski</a>, <a href="https://home.msbstats.info/" class="external-link">Mattan S. Ben-Shachar</a>, <a href="https://sites.google.com/site/indrajeetspatilmorality/" class="external-link">Indrajeet Patil</a>, Philip Waggoner, <a href="https://wiernik.org/" class="external-link">Brenton M. Wiernik</a>, <a href="https://remi-theriault.com/" class="external-link">Rémi Thériault</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
